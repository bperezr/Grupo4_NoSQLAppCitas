<div class="content">
    <div class="content__title">
        <h1>Crear cita</h1>
    </div>
    <div class="general-container">
            <div class="info-container">
                <div class="content__title">
                  <h3>Datos de la cita</h3>
                </div>
                <table class="info-table">
                  <tr>
                    <th>Paciente</th>
                    <td>
                      <input type="text" name="paciente" placeholder="Nombre del paciente">
                    </td>
                  </tr>
                  <tr>
                    <th>Motivo</th>
                    <td>
                      <input type="text" name="motivo" placeholder="Motivo de la cita">
                    </td>
                  </tr>
                  <tr>
                    <th>Estado</th>
                    <td>
                      <select name="estado">
                        <option value="pendiente">Pendiente</option>
                        <option value="confirmada">Confirmada</option>
                        <option value="cancelada">Cancelada</option>
                      </select>
                    </td>
                  </tr>  
                </table>
              </div>      
          
              <div class="agenda-container">                     
                <div class="content__title">
                    <h3>Seleccione la fecha y hora</h3>
                </div>
                <div class="calendar-container">
                    <input type="hidden" id="doctorIdInput" value="68000a08774fcfc27226ad06">
                    <div class="calendar-header">
                      <button onclick="changeMonth(-1)"><i class="fa fa-chevron-left"></i></button>
                      <h2 id="monthYear">Mes AÃ±o</h2>
                      <button onclick="changeMonth(1)"><i class="fa fa-chevron-right"></i></button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">                    
                    </div>
                  </div>                
                  <div class="time-slot-container">
                    <h3>Seleccione una hora</h3>
                    <div id="timeSlots" class="time-slot-grid">             
                    </div>
                  </div>
            </div>
          
    </div>  
</div>

<script>
    const horariosBase = [
      "08:00", "09:00", "10:00","11:00","12:00", 
      "13:00", "14:00","15:00","16:00","17:00","18:00"
    ];
  
    let currentDate = new Date();
    let selectedDate = null;
  
    function renderCalendar(date) {
      const calendarGrid = document.getElementById("calendarGrid");
      const monthYear = document.getElementById("monthYear");
      calendarGrid.innerHTML = "";
  
      const year = date.getFullYear();
      const month = date.getMonth();
  
      monthYear.textContent = date.toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });
  
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();  

      for (let i = 0; i < firstDay; i++) {
        const emptyCell = document.createElement("div");
        calendarGrid.appendChild(emptyCell);
      }
  
      for (let day = 1; day <= daysInMonth; day++) {
        const cell = document.createElement("div");
        cell.className = "calendar-cell";
        cell.textContent = day;
  
        const fullDate = new Date(year, month, day);
        const isoDate = fullDate.toISOString().split('T')[0];
  
        cell.onclick = () => {
        selectedDate = isoDate;
        const doctorId = document.getElementById('doctorIdInput').value; 

        document.querySelectorAll('.calendar-cell').forEach(c => c.classList.remove('selected'));
        cell.classList.add('selected');
        cargarHoras(isoDate, doctorId); 
        };
  
        calendarGrid.appendChild(cell);
      }
    }
  
    function changeMonth(offset) {
      currentDate.setMonth(currentDate.getMonth() + offset);
      renderCalendar(currentDate);
    }
  

function cargarHoras(fecha, doctorId) {
  fetch(`/admin/horariosNoDisponible?fecha=${fecha}&doctorId=${doctorId}`)
    .then(res => res.json())
    .then(data => {
      console.log("Respuesta de la API:", data);
      const bloqueados = [];

      data.forEach(h => {
        const inicio = parseInt(h.horaInicio.split(':')[0], 10);
        const fin    = parseInt(h.horaFin.split(':')[0], 10);

        for (let i = inicio; i < fin; i++) {
          bloqueados.push(`${String(i).padStart(2, '0')}:00`);
        }
      });

      console.log("Horarios bloqueados:", bloqueados);

      const contenedor = document.getElementById('timeSlots');
      contenedor.innerHTML = '';

      horariosBase.forEach(hora => {
        const btn = document.createElement('button');
        btn.textContent = hora;
        btn.disabled = bloqueados.includes(hora);
        btn.onclick  = () => seleccionarHora(hora, fecha);
        contenedor.appendChild(btn);
      });
    })
    .catch(err => {
      console.error('Error al cargar los horarios:', err);
    });
}

renderCalendar(currentDate);
  </script>



